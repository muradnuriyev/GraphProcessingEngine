<UserControl x:Class="GraphProcessingEngine.Gui.Wpf.Views.GraphCanvasView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:GraphProcessingEngine.Gui.Wpf.ViewModels">
    <UserControl.Resources>
        <DropShadowEffect x:Key="DropShadowEffect"
                          ShadowDepth="4"
                          BlurRadius="8"
                          Color="#AA000000" />
        <Style TargetType="Border" x:Key="NodeDragStyle">
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="Node_PreviewMouseLeftButtonDown" />
            <EventSetter Event="PreviewMouseLeftButtonUp" Handler="Node_PreviewMouseLeftButtonUp" />
            <EventSetter Event="PreviewMouseMove" Handler="Node_PreviewMouseMove" />
        </Style>
    </UserControl.Resources>
    <Grid x:Name="CanvasHost"
          Background="#0B1220"
          MouseLeftButtonDown="Surface_MouseLeftButtonDown">
        <ItemsControl ItemsSource="{Binding Edges}"
                      IsHitTestVisible="False">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas Width="{Binding ActualWidth, ElementName=CanvasHost}"
                            Height="{Binding ActualHeight, ElementName=CanvasHost}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type vm:EdgeViewModel}">
                    <Line X1="{Binding X1}"
                          Y1="{Binding Y1}"
                          X2="{Binding X2}"
                          Y2="{Binding Y2}"
                          Stroke="#3B82F6"
                          StrokeThickness="2"
                          StrokeDashCap="Round"
                          StrokeStartLineCap="Round"
                          StrokeEndLineCap="Round">
                        <Line.Style>
                            <Style TargetType="Line">
                                <Setter Property="Stroke" Value="#3B82F6" />
                                <Setter Property="StrokeThickness" Value="2" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsHighlighted}" Value="True">
                                        <Setter Property="Stroke" Value="#FBBF24" />
                                        <Setter Property="StrokeThickness" Value="3" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Line.Style>
                    </Line>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <ItemsControl ItemsSource="{Binding Nodes}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas Width="{Binding ActualWidth, ElementName=CanvasHost}"
                            Height="{Binding ActualHeight, ElementName=CanvasHost}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type vm:NodeViewModel}">
                    <Border Width="36"
                            Height="36"
                            Background="#1D4ED8"
                            BorderBrush="#60A5FA"
                            BorderThickness="2"
                            CornerRadius="18"
                            Canvas.Left="{Binding X}"
                            Canvas.Top="{Binding Y}"
                            Effect="{DynamicResource DropShadowEffect}">
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource NodeDragStyle}">
                                <Setter Property="Background" Value="#1D4ED8" />
                                <Setter Property="BorderBrush" Value="#60A5FA" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="Background" Value="#2563EB" />
                                        <Setter Property="BorderBrush" Value="#FBBF24" />
                                        <Setter Property="BorderThickness" Value="3" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsHighlighted}" Value="True">
                                        <Setter Property="Background" Value="#FBBF24" />
                                        <Setter Property="BorderBrush" Value="#F59E0B" />
                                        <Setter Property="BorderThickness" Value="3" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <TextBlock Text="{Binding Id}"
                                   Foreground="White"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</UserControl>
